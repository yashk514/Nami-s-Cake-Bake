<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nami's Cake and Bake - My Profile</title>
    <link
      rel="shortcut icon"
      href="assets/favicon_io/favicon-16x16.png"
      type="image/x-icon"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Quicksand:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
    <!-- Link the main stylesheet -->
    <style>
      /* --- Basic Styles (Assumed from styles.css or defined here) --- */
      :root {
        --primary: #e05e85;
        --secondary: #fff;
        --accent: #5c4033;
        --light: #fff;
        --dark: #3c3c3c;
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        --testimonial-bg: radial-gradient(
          circle,
          rgba(230, 227, 227, 1) 0%,
          rgba(255, 222, 235, 1) 100%
        );
        --footer: #4e4e4e;
      }
      body {
        margin: 0;
        font-family: "Quicksand", sans-serif;
       background: linear-gradient(to bottom right, #ffffff, rgba(224, 94, 133, 0.2));
     
        color: var(--dark);
        line-height: 1.6;
      }
      nav {
        background-color: white;
        box-shadow: var(--shadow);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .brand {
        display: flex;
        align-items: center;
      }
      .nav-icon {
        width: 32px;
        height: 32px;
        margin-right: 10px;
      }
      .logo {
        font-family: "Playfair Display", serif;
        font-size: 1.8rem;
        color: var(--accent);
        font-weight: bold;
      }
      .nav-links {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .nav-links li {
        margin-left: 30px;
      }
      .nav-links a {
        text-decoration: none;
        color: var(--dark);
        font-weight: 600;
        transition: color 0.3s;
      }
      .nav-links a:hover,
      .nav-links a.active {
        color: var(--primary);
      }
      .hamburger {
        display: none;
        font-size: 28px;
        background: none;
        border: none;
        cursor: pointer;
        color: var(--dark);
      }
      .btn {
        /* Basic button style */
        display: inline-block;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        background-color: var(--footer);
        color: white;
        font-weight: bold;
        cursor: pointer;
        border: none;
        transition: background-color 0.3s, transform 0.2s;
        text-align: center;
      }
      .btn:hover {
        background-color: #4d3327;
        transform: translateY(-2px);
      }
      @media (max-width: 768px) {
        .nav-links {
          display: none;
          flex-direction: column;
          position: absolute;
          top: 100%;
          right: 15px;
          background-color: white;
          box-shadow: var(--shadow);
          width: 200px;
          padding: 15px;
          z-index: 999;
        }
        .nav-links.active {
          display: flex;
        }
        .nav-links li {
          margin: 10px 0;
          margin-left: 0;
        }
        .hamburger {
          display: block;
        }
      }
      /* --- End Basic Styles --- */

      /* --- Profile Page Specific Styles --- */
      .profile-container {
        max-width: 700px;
        margin: 50px auto;
        padding: 35px 40px;
        background-color: #fff;
        border-radius: 15px;
        box-shadow: var(--shadow);
        text-align: center;
      }
      .profile-container h1 {
        font-family: "Playfair Display", serif;
        color: var(--accent);
        margin-bottom: 25px;
        font-size: 2.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }
      .profile-container h1 .fa-user-circle {
        color: var(--primary);
        font-size: 1.8rem;
      }
      .profile-info {
        margin-bottom: 30px;
        text-align: left;
        background-color: #fdfaf7;
        padding: 25px;
        border-radius: 10px;
        border: 1px solid #eee;
      }
      .profile-info h2 {
        font-family: "Playfair Display", serif;
        font-size: 1.4rem;
        color: var(--accent);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--secondary);
      }
      .profile-info p {
        margin-bottom: 15px;
        font-size: 1.05em;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 8px;
        line-height: 1.5;
      }
      .profile-info p i.fas {
        color: var(--primary);
        width: 20px;
        text-align: center;
      }
      .profile-info strong {
        font-weight: 600;
        min-width: 150px;
        display: inline-block;
      }
      #user-email,
      #user-display-name,
      #user-creation-time,
      #user-last-signin {
        font-weight: 500;
        color: #555;
        word-break: break-all;
      }
      .info-placeholder {
        font-style: italic;
        color: #888;
      }
      .profile-actions {
        margin-top: 30px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }
      .profile-actions .btn,
      .profile-actions a.btn {
        padding: 10px 25px;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        min-width: 200px;
        text-align: center;
        transition: all 0.3s ease;
      }
      #continue-shopping-btn {
        background-color: var(--footer);
        color: white;
        border: none;
      }
      #continue-shopping-btn:hover {
        background-color: #4d3327;
      }
      #logout-button {
        background-color: var(--primary);
        color: white;
        border: none;
      }
      #logout-button:hover {
        background-color: var(--primary);
        transform: translateY(-2px);
      }

      /* --- Order History Styles --- */
      .order-history {
        margin-top: 40px;
        text-align: left;
        border-top: 1px solid #eee;
        padding-top: 30px;
      }
      .order-history h2 {
        font-family: "Playfair Display", serif;
        font-size: 1.6rem;
        color: var(--accent);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
      }
      .order-history h2 .fa-history {
        color: var(--primary);
      }
      #order-history-container {
        min-height: 50px;
        position: relative;
      }
      .loading-orders,
      .no-orders-message {
        text-align: center;
        color: #888;
        padding: 20px;
        font-style: italic;
      }
      .order-card {
        background-color: #fff;
        border: 1px solid #e8e8e8;
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      .order-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px dashed #eee;
        gap: 10px;
        font-size: 0.9em;
      }
      .order-header .order-id {
        font-weight: bold;
        color: var(--accent);
      }
      .order-header .order-date {
        color: #555;
      }
      .order-header .order-status {
        font-weight: bold;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        text-transform: uppercase;
        color: white;
        background-color: #ffa000; /* Default: Pending */
      }
      .order-status.confirmed {
        background-color: #4caf50;
      } /* Add more statuses as needed */
      .order-status.shipped {
        background-color: #03a9f4;
      }
      .order-status.delivered {
        background-color: #3f51b5;
      }
      .order-status.cancelled {
        background-color: #f44336;
      }
      .order-items-list {
        margin: 15px 0;
        font-size: 0.9em;
        padding-left: 5px;
      }
      .order-items-list ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .order-items-list li {
        margin-bottom: 6px;
        color: #444;
      }
      .order-items-list li span.item-qty {
        display: inline-block;
        min-width: 45px;
        margin-right: 8px;
        color: #777;
      }
      .order-total {
        text-align: right;
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid #eee;
        font-weight: bold;
        font-size: 1.05em;
      }
      .order-total span {
        color: var(--primary);
      }

      /* Responsive */
      @media (max-width: 600px) {
        .profile-container {
          margin: 30px 15px;
          padding: 25px;
        }
        .profile-container h1 {
          font-size: 1.8rem;
        }
        .profile-info {
          padding: 20px;
        }
        .profile-info h2 {
          font-size: 1.2rem;
        }
        .profile-info p {
          font-size: 0.95em;
          flex-direction: column;
          align-items: flex-start;
          gap: 5px;
          margin-bottom: 18px;
        }
        .profile-info strong {
          min-width: auto;
          margin-bottom: 3px;
        }
        .profile-actions .btn,
        .profile-actions a.btn {
          min-width: 180px;
          padding: 10px 20px;
        }
        .order-history h2 {
          font-size: 1.4rem;
        }
        .order-card {
          padding: 15px;
        }
        .order-header {
          flex-direction: column;
          align-items: flex-start;
        }
        .order-total {
          text-align: left;
          font-size: 1em;
        }
      }
      /* --- Footer Styles --- */
      footer {
        background: var(--footer);
        color: white;
        padding: 60px 20px 30px;
        margin-top: 60px;
      }
      .footer-container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
      }
      .footer-col h3 {
        font-family: "Playfair Display", serif;
        margin-bottom: 20px;
        font-size: 1.3rem;
        position: relative;
        padding-bottom: 10px;
      }
      .footer-col h3::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 50px;
        height: 2px;
        background: var(--primary);
      }
      .footer-col p {
        margin-bottom: 20px;
        font-size: 0.95rem;
        opacity: 0.9;
      }
      .footer-links {
        list-style: none;
        padding-left: 0;
        margin: 0;
      }
      .footer-links li {
        margin-bottom: 12px;
        display: flex;
        align-items: center;
      }
      .footer-links i.fas {
        margin-right: 10px;
        width: 20px;
        color: var(--primary);
        text-align: center;
      }
      .footer-links a {
        color: white;
        text-decoration: none;
        transition: all 0.3s;
        font-size: 0.95rem;
      }
      .footer-links a:hover {
        color: var(--secondary);
        padding-left: 5px;
        
      }
      .social-links {
        display: flex;
        margin-top: 20px;
        padding: 0;
      }
      .social-links a {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        margin-right: 10px;
        color: white;
        transition: all 0.3s;
      }
      .social-links a:last-child {
        margin-right: 0;
      }
      .social-links a:hover {
        background: var(--primary);
        transform: translateY(-3px);
      }
      .copyright {
        text-align: center;
        margin-top: 60px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.9rem;
        opacity: 0.8;
      }
      @media (max-width: 768px) {
        .footer-container {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          text-align: center;
        }
        .footer-col {
          display: flex;
          flex-direction: column;
          align-items: center;
        }
        .footer-col h3::after {
          left: 50%;
          transform: translateX(-50%);
        }
        .social-links,
        .footer-links li {
          justify-content: center;
        }
        .footer-links i.fas {
          margin-left: auto;
          margin-right: 10px;
        } /* Adjust icon position */
      }
      @media (max-width: 480px) {
        .footer-container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav>
      <div class="nav-container">
        <div class="brand">
            <div class="logo-text">
              Nami's <span class="highlight-word">Cake</span> & Bake
            </div>
          </div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="cakes.html">Cakes</a></li>
          <li><a href="gallery.html">Gallery</a></li>
          <li><a href="classes.html">Classes</a></li>
          <li><a href="upcoming-classes.html">Schedule</a></li>
          <li id="cart-nav-item">
            <a href="cart.html">
              <i class="fas fa-shopping-cart"></i> Cart
              <span
                id="cart-count"
                style="
                  background-color: var(--primary);
                  color: white;
                  border-radius: 50%;
                  padding: 2px 6px;
                  font-size: 0.7em;
                  margin-left: 4px;
                  display: none;
                "
                >0</span
              >
            </a>
          </li>

          <li id="login-nav-item"><a href="login.html">Login</a></li>
          <li id="profile-nav-item" style="display: none">
            <a href="profile.html">My Profile</a>
          </li>
        </ul>
        <button class="hamburger" id="hamburger">☰</button>
      </div>
    </nav>

    <!-- Main Profile Section -->
    <main class="profile-container">
      <h1><i class="fas fa-user-circle"></i>My Profile</h1>

      <!-- Account Details -->
      <div class="profile-info">
        <h2>Account Details</h2>
        <p>
          <i class="fas fa-user"></i><strong>Display Name:</strong>
          <span id="user-display-name" class="info-placeholder"
            >Not Available</span
          >
        </p>
        <p>
          <i class="fas fa-envelope"></i><strong>Email:</strong>
          <span id="user-email" class="info-placeholder">Loading...</span>
        </p>
        <p>
          <i class="fas fa-calendar-check"></i
          ><strong>Account Created:</strong>
          <span id="user-creation-time" class="info-placeholder"
            >Loading...</span
          >
        </p>
        <p>
          <i class="fas fa-clock"></i><strong>Last Sign-in:</strong>
          <span id="user-last-signin" class="info-placeholder">Loading...</span>
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="profile-actions">
        <a href="cakes.html" id="continue-shopping-btn" class="btn"
          >Continue Shopping</a
        >
        <button id="logout-button" class="btn">Logout</button>
      </div>

      <!-- Order History Section -->
      <div class="order-history">
        <h2><i class="fas fa-history"></i> Order History</h2>
        <div id="order-history-container">
          <p class="loading-orders">Loading your orders...</p>
          <!-- Orders will be loaded here by JavaScript -->
        </div>
      </div>
      <!-- End Order History Section -->
    </main>

    <!-- Footer -->
    <footer>
      <div class="footer-container">
        <div class="footer-col">
          <h3>Nami's Cake and Bake</h3>
          <p>Creating delicious memories since 2015.</p>
          <div class="social-links">
            <a
              href="https://www.instagram.com/namis_cakenbake_/"
              target="_blank"
              rel="noopener noreferrer"
              ><i class="fab fa-instagram"></i
            ></a>
            <a
              href="https://wa.me/918767542742"
              target="_blank"
              rel="noopener noreferrer"
              ><i class="fab fa-whatsapp"></i
            ></a>
          </div>
        </div>
        <div class="footer-col">
          <h3>Quick Links</h3>
          <ul class="footer-links">
            <li>
              <a href="index.html"><i class="fas fa-home"></i>Home</a>
            </li>
            <li>
              <a href="cakes.html"><i class="fas fa-birthday-cake"></i>Cakes</a>
            </li>
            <li>
              <a href="classes.html"
                ><i class="fas fa-chalkboard-teacher"></i>Classes</a
              >
            </li>
            <li>
              <a href="gallery.html"><i class="fas fa-images"></i>Gallery</a>
            </li>
            <li>
              <a href="contact.html"><i class="fas fa-envelope"></i>Contact</a>
            </li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>Contact Info</h3>
          <ul class="footer-links">
            <li>
              <a
                href="https://maps.app.goo.gl/rrWJ13ZhduxjfGzz7"
                target="_blank"
                rel="noopener noreferrer"
                ><i class="fas fa-map-marker-alt"></i> Vishrambag, Sangli</a
              >
            </li>
            <li><i class="fas fa-phone"></i> +91 8767542742</li>
            <li><i class="fas fa-envelope"></i> info@namiscakeandbake.com</li>
            <li><i class="fas fa-clock"></i> Mon-Sat: 9am-7pm</li>
          </ul>
        </div>
      </div>
      <div class="copyright">
        © 2025 Nami's Cake and Bake. All rights reserved.
      </div>
    </footer>





    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-NXYG9PJ8KQ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-NXYG9PJ8KQ");
    </script>

    <!-- Firebase Initialization and Profile Logic -->
    <script type="module">
      // Import functions from the Firebase SDKs
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
      // Import Firestore functions
      import {
        getFirestore,
        collection,
        query,
        where,
        getDocs,
        orderBy,
      } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

      // --- PASTE YOUR FIREBASE CONFIGURATION OBJECT HERE ---
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyCmCvKtfl6QtA4EUEyTsfQxczvpy-5jTt0",
        authDomain: "namis-cake-bake-auth.firebaseapp.com",
        projectId: "namis-cake-bake-auth",
        storageBucket: "namis-cake-bake-auth.firebasestorage.app",
        messagingSenderId: "213318410638",
        appId: "1:213318410638:web:5d0531e93ed38f434c04df",
        measurementId: "G-HPWS91PN1C",
      };
      // --- END FIREBASE CONFIG ---

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app); // Initialize Firestore

      // --- Cart Management Function (for Nav count only) ---
      const CART_KEY = "namiShopCart";
      function updateCartCount() {
        const cart = localStorage.getItem(CART_KEY)
          ? JSON.parse(localStorage.getItem(CART_KEY))
          : [];
        const cartCountSpan = document.getElementById("cart-count");
        if (cartCountSpan) {
          const totalItems = cart.reduce(
            (sum, item) => sum + (Number(item.quantity) || 0),
            0
          );
          cartCountSpan.textContent = totalItems;
          cartCountSpan.style.display =
            totalItems > 0 ? "inline-block" : "none";
        }
      }
      // --- END Cart Management ---

      // --- Function to Format Timestamps ---
      function formatFirebaseTimestamp(timestamp) {
        if (!timestamp) return "N/A";
        try {
          let date;
          // Handle Firestore Timestamp object specifically
          if (timestamp && typeof timestamp.toDate === "function") {
            date = timestamp.toDate();
          } else if (typeof timestamp === "object" && timestamp.seconds) {
            // Handle older format if needed
            date = new Date(timestamp.seconds * 1000);
          } else if (
            typeof timestamp === "string" ||
            typeof timestamp === "number"
          ) {
            // Handle string/number timestamp
            date = new Date(timestamp);
          } else {
            return "Invalid Date";
          } // Cannot parse

          if (isNaN(date.getTime())) {
            return "Invalid Date";
          } // Check validity

          // Format to a readable string (e.g., "Jul 26, 2024")
          return date.toLocaleString(undefined, {
            year: "numeric",
            month: "short",
            day: "numeric",
          });
        } catch (e) {
          console.error("Error formatting timestamp:", e);
          return "Error";
        }
      }
      // --- END Timestamp Formatting ---

      // --- Function to Fetch and Render Order History ---
      async function renderOrderHistory(userId) {
        const container = document.getElementById("order-history-container");
        if (!container) {
          console.error("Order history container missing!");
          return;
        }
        container.innerHTML =
          '<p class="loading-orders">Loading your orders...</p>';

        try {
          const ordersRef = collection(db, "orders");
          const q = query(
            ordersRef,
            where("userId", "==", userId),
            orderBy("orderDate", "desc")
          );
          const querySnapshot = await getDocs(q);

          if (querySnapshot.empty) {
            container.innerHTML =
              '<p class="no-orders-message">You haven\'t placed any orders yet.</p>';
            return;
          }

          container.innerHTML = ""; // Clear loading message

          querySnapshot.forEach((doc) => {
            const order = doc.data();
            const orderId = doc.id;
            const orderCard = document.createElement("div");
            orderCard.classList.add("order-card");
            const statusClass = String(order.orderStatus || "pending")
              .toLowerCase()
              .replace(/\s+/g, "-");

            let itemsHtml = "<ul>";
            if (order.items && Array.isArray(order.items)) {
              order.items.forEach((item) => {
                itemsHtml += `<li><span class="item-qty">Qty ${
                  item.quantity || 1
                }:</span> ${item.name || "Unknown Item"}</li>`;
              });
            } else {
              itemsHtml += "<li>Item details not available.</li>";
            }
            itemsHtml += "</ul>";

            orderCard.innerHTML = `
                        <div class="order-header">
                            <span class="order-id">Order ID: ${orderId.substring(
                              0,
                              8
                            )}...</span>
                            <span class="order-date">Placed: ${formatFirebaseTimestamp(
                              order.orderDate
                            )}</span>
                            <span class="order-status ${statusClass}">${
              order.orderStatus || "Pending"
            }</span>
                        </div>
                        <div class="order-items-list">
                            <strong>Items:</strong>
                            ${itemsHtml}
                        </div>
                        <div class="order-total">
                            Total: <span>₹ ${Number(
                              order.totalAmount || 0
                            ).toFixed(2)}</span>
                        </div>
                    `;
            container.appendChild(orderCard);
          });
        } catch (error) {
          console.error("Error fetching order history:", error);
          container.innerHTML =
            '<p class="no-orders-message" style="color: red;">Could not load order history.</p>';
        }
      }
      // --- END Render Order History ---

      // --- Code to Run When Page Loads ---
      document.addEventListener("DOMContentLoaded", function () {
        const hamburger = document.getElementById("hamburger");
        const navLinks = document.querySelector(".nav-links");
        const userEmailSpan = document.getElementById("user-email");
        const displayNameSpan = document.getElementById("user-display-name");
        const creationTimeSpan = document.getElementById("user-creation-time");
        const lastSignInSpan = document.getElementById("user-last-signin");
        const logoutButton = document.getElementById("logout-button");

        // Hamburger Menu Logic
        if (hamburger && navLinks) {
          hamburger.addEventListener("click", () =>
            navLinks.classList.toggle("active")
          );
        }

        // --- Firebase Auth: Check Login Status ---
        onAuthStateChanged(auth, (user) => {
          const loginNavItem = document.getElementById("login-nav-item");
          const profileNavItem = document.getElementById("profile-nav-item");

          if (user) {
            // User is signed in: Display profile info
            if (userEmailSpan) {
              userEmailSpan.textContent = user.email || "N/A";
              userEmailSpan.classList.remove("info-placeholder");
            }
            if (displayNameSpan) {
              displayNameSpan.textContent = user.displayName || "Not Set";
              displayNameSpan.classList.toggle(
                "info-placeholder",
                !user.displayName
              );
            }
            // Use updated timestamp formatting for user metadata as well
            if (creationTimeSpan && user.metadata) {
              creationTimeSpan.textContent = formatFirebaseTimestamp(
                user.metadata.creationTime
              );
              creationTimeSpan.classList.remove("info-placeholder");
            } else if (creationTimeSpan) {
              creationTimeSpan.textContent = "N/A";
              creationTimeSpan.classList.add("info-placeholder");
            }
            if (lastSignInSpan && user.metadata) {
              lastSignInSpan.textContent = formatFirebaseTimestamp(
                user.metadata.lastSignInTime
              );
              lastSignInSpan.classList.remove("info-placeholder");
            } else if (lastSignInSpan) {
              lastSignInSpan.textContent = "N/A";
              lastSignInSpan.classList.add("info-placeholder");
            }

            // Update Nav Bar
            if (loginNavItem) loginNavItem.style.display = "none";
            if (profileNavItem) profileNavItem.style.display = "list-item";

            // --- Load Order History for this user ---
            renderOrderHistory(user.uid);
          } else {
            // No user is signed in: Redirect to login
            console.log("profile.html: User signed out, redirecting...");
            window.location.href = "login.html";
          }
        });

        // --- Logout Button Logic ---
        if (logoutButton) {
          logoutButton.addEventListener("click", async () => {
            try {
              await signOut(auth);
              console.log("Logout successful");
              // Redirect is handled by onAuthStateChanged listener
            } catch (error) {
              console.error("Logout failed:", error);
              alert("Logout failed. Please try again.");
            }
          });
        }

        // --- Initial Setup ---
        updateCartCount(); // Update cart icon in nav
      }); // End DOMContentLoaded
    </script>
  </body>
</html>
